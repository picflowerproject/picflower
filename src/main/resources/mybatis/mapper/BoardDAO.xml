<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.picflower.dao.IboardDAO">
	 <!-- [설정] DB 컬럼 b_image를 DTO 필드 b_image_name에 매핑 -->
    <resultMap id="boardResultMap" type="com.picflower.dto.BoardDTO">
        <id property="b_no" column="b_no" />
        <result property="b_image_name" column="b_image"/>
        <result property="m_id" column="m_id"/>
    </resultMap>

    <!-- 후기글 목록 보기 (회원정보 포함) -->
    <select id="b_listDao" resultMap="boardResultMap">
        SELECT b.b_no, b.b_date, b.b_text, b.b_image, b.b_rating, b.b_like, b.m_no, m.m_id 
        FROM Board b 
        INNER JOIN member m ON b.m_no = m.m_no 
        ORDER BY b.b_no DESC
    </select>

    <!-- 인터페이스에 정의된 b_listWithMemberDao 매핑 -->
    <select id="b_listWithMemberDao" resultMap="boardResultMap">
        SELECT b.b_no, b.b_date, b.b_text, b.b_image, b.b_rating, b.b_like, b.m_no, m.m_id 
        FROM Board b 
        INNER JOIN member m ON b.m_no = m.m_no 
        ORDER BY b.b_no DESC
    </select>

    <!-- 후기 글 입력 (m_no 포함) -->
    <insert id="b_insertDao">
        INSERT INTO board(b_no, b_date, b_image, b_text, b_rating, b_like, m_no)
        VALUES (board_seq.nextval, SYSDATE, #{b_image_name, jdbcType=VARCHAR}, #{b_text}, #{b_rating}, 0, #{m_no})
    </insert>

    <!-- 특정 게시글 상세 보기 -->
    <select id="b_viewWithMemberDao" resultMap="boardResultMap">
        SELECT b.*, m.m_id 
        FROM board b
        INNER JOIN member m ON b.m_no = m.m_no
        WHERE b.b_no = #{b_no}
    </select>

    <update id="upLike">
        UPDATE board SET b_like = b_like + 1 WHERE b_no = #{b_no}
    </update>

    <select id="getLikeCount" resultType="int">
        SELECT b_like FROM board WHERE b_no = #{b_no}
    </select>

    <update id="b_updateDao">
        UPDATE board SET b_text = #{b_text}, b_date = SYSDATE WHERE b_no = #{b_no}
    </update>

    <delete id="b_deleteDao">
        DELETE FROM board WHERE b_no = #{b_no}
    </delete>
	
</mapper>
